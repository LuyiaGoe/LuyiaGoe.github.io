---
title: 流媒体服务器搭建
layout: post
author: LuyiaGoe
categories: Ohter
cover: false
coverImg: ""
top: true
mathjax: false
tags:
  - Other
excerpt: post
summary: ""
date: 2023-10-12 14:07:44
---

# 流媒体服务器搭建

## Windows

1. 下载 [nginx_1.7.11.3_Gryphon.zip](http://nginx-win.ecsds.eu/download/)
2. 解压 zip 后，在其根目录下拉取 rtmp 组件：https://github.com/arut/nginx-rtmp-module
3. 修改 zip 解压后地 `conf/nginx-win.conf` 文件：

   ```
   ...
   events {
       worker_connections  8192;
       # max value 32768, nginx recycling connections+registry optimization =
       #   this.value * 20 = max concurrent connections currently tested with one worker
       #   C1000K should be possible depending there is enough ram/cpu power
       # multi_accept on;
   }

   # 关键点在此，添加以下配置
   rtmp {
       server {
           listen 1935;                #监听端口,若被占用,可以更改
           chunk_size 4000;            #上传flv文件块儿的大小
           application live {          #创建一个叫live的应用，即推流路径名
               live on;                #开启live的应用
               allow publish 127.0.0.1;
               allow play all;
           }
       }
   }

   http {
       ...
   }
   ...
   ```

4. 启动 nginx：
   ```
   nginx.exe -c conf\nginx-win.conf
   nginx.exe -s stop    //快速终止服务器，可能不保存相关信息
   nginx.exe -s quit    //完整有序停止服务器，保存相关信息
   nginx.exe -s reload  //重新载入Nginx，当配置信息修改，需要重新载入这些配置时使用此命令
   ```

## Linux

可以采用[SRS](https://ossrs.net/lts/zh-cn/)快速搭建，支持 Docker、源码编译、K8s 部署

以下采用源码编译举例：

```shell
$ git clone -b develop https://gitee.com/ossrs/srs.git
$ cd srs/trunk && ./configure
$ make
```

编译结束后即可启动服务器

```shell
$ ./objs/srs -c conf/srs.conf
```

检查 SRS 是否成功启动，可以打开 http://localhost:8080/ ，或者执行命令：

```shell
# 查看SRS的状态
$ ./etc/init.d/srs status

# 或者看SRS的日志
$ tail -n 30 -f ./objs/srs.log
```

打开下面的页面播放流（若 SRS 不在本机，请将 localhost 更换成服务器 IP）:

- RTMP (by VLC): rtmp://localhost/live/test
- H5(HTTP-FLV): http://localhost:8080/live/test.flv
- H5(HLS): http://localhost:8080/live/test.m3u8

# 推流工具

## OBS

测试直播推流可以采用[OBS](https://obsproject.com/)软件推流

### Windows

1. 在官网下载并安装 OBS
2. 在顶部菜单栏中依次点击选择`文件->设置->直播`，选择服务为`自定义`，并将服务器选为 rtmp 服务器如`rtmp://localhost:1935/live`
3. 在主界面的`来源`模块中，添加`显示器采集`源
4. 在`控制按钮`处点击`开始直播`

### Linux

```shell
$ sudo add-apt-repository ppa:obsproject/obs-studio
$ sudo apt update
$ sudo apt install obs-studio
```

## ffmpeg

[ffmpeg](https://ffmpeg.org/)可以进行命令行推流

### Windows

1. 在官网下载并安装`ffmpeg`
2. 可以将本地视频用命令行推流至服务器上：
   ```
   ffmpeg -re -i [video file] -c copy -f flv [server]
   ```

### Linux

1. 在官网下载包并解压
2. 进入目录后配置
   ```shell
   $ cd ffmpeg && ./configure
   ```
3. 编译并安装
   ```shell
   $ make && make install
   ```
